{% extends "fitness_test_base.html" %}

{% block content_fitness_testing_base  %}

    <form method="POST" enctype="multipart/form-data" action="{{ post_to_url }}" class="form-horizontal" id="doneForm">
    {% csrf_token %}

        <!-- Fixed navbar -->
        <div class="navbar navbar-default navbar-fixed-top">
            <div class="navbar-header">
                <div class="navbar-brand">Fitness Testing App - Results Page</div><br>
            </div>
        </div>
        <!-- Fixed navbar -->

        <h4>Student: {{ student_name }}</h4>
        <h4>Age/Gender: {{ age }}/{{ gender }}</h4>

        {% for mtc in major_test_categories %}
            <h3>{{ mtc }}</h3>
            <div id="{{ mtc }}_chart" style="width:600px;height:300px"></div>
        {% endfor %}

        <input type="submit" class="btn btn-primary" name='results_done_button' value="Done">

    </form>

    <script>
        $(document).ready(function() {

            {% for mtc, tc in mtc_tc %}
                var {{ mtc }}_{{ tc }}_data = [
                    {% for inner_mtc, inner_tc, test_name, percentile, result in results %}
                        {% if inner_mtc == mtc and inner_tc == tc %}
                            [{{ forloop.counter0 }}, {{ percentile }}],
                        {% endif %}
                    {% endfor %}
                ];
            {% endfor %}

            {% for mtc in major_test_categories %}
                var {{ mtc }}_ticks = [
                    {% for inner_mtc, cat, test_name, percentile, result in results %}
                        {% if inner_mtc == mtc %}
                            [{{ forloop.counter0 }}, "{{ test_name }}"],
                        {% endif %}
                    {% endfor %}
                ];

                var {{ mtc }}_chart_options = {
                    axisLabels: {
                        show: true
                    },
                    xaxis: {
                        axisLabel: 'Test',
                        ticks: {{ mtc }}_ticks
                    },
                    yaxis: {
                        position: 'left',
                        axisLabel: 'Percentile'
                    },
                    series: {
                        bars: {
                            show: true
                        }
                    },
                    bars: {
                        align: "center",
                        barWidth: 1
                    }
                 };

                var {{ mtc }}_dataset = [
                    {% for inner_mtc, inner_tc in mtc_tc %}
                        {% if inner_mtc == mtc %}
                                { label: "{{ inner_tc }}", data: {{ mtc }}_{{ inner_tc }}_data },
                        {% endif %}
                    {% endfor %}
                ];

                $.plot("#{{ mtc }}_chart",
                        {{ mtc }}_dataset,
                        {{ mtc }}_chart_options);
            {% endfor %}

        });
    </script>

{% endblock %}

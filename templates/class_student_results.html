{% extends "fitness_test_base.html" %}

{% block content_fitness_testing_base  %}

    <form method="POST" enctype="multipart/form-data" action="{{ post_to_url }}" class="form-horizontal" id="doneForm">
    {% csrf_token %}

        <!-- Fixed navbar -->
        <div class="navbar navbar-default navbar-fixed-top">
            <div class="navbar-header">
                <div class="navbar-brand">Fitness Testing App - Results Page</div><br>
            </div>
        </div>
        <!-- Fixed navbar -->

        <h4>Student: {{ student_name }}</h4>
        <h4>Age/Gender: {{ age }}/{{ gender }}</h4>

        {% for major_category, major_category_text, categories in results %}
            <h3>{{ major_category_text }}</h3>
            <div class="student_result_view" id="{{ major_category }}_chart" style="width:600px;height:300px"></div>
        {% endfor %}

        <input type="submit" class="btn btn-primary" name='results_done_button' value="Done">

    </form>

    <script>
        $(document).ready(function() {

            {% for major_category, major_category_text, categories in results %}
                {% for category, category_text, tests in categories %}
                    var {{ major_category }}_{{ category }}_data = [
                        {% for count, test, test_text, percentile in tests %}
                            [{{ count }}, {{ percentile }}],
                        {% endfor %}
                    ];
                {% endfor %}
            {% endfor %}

            {% for major_category, major_category_text, categories in results %}

                var {{ major_category }}_ticks = [
                    {% for category, category_text, tests in categories %}
                        {% for count, test, test_text, percentile in tests %}
                            [{{ count }}, "{{ test_text }}"],
                        {% endfor %}
                    {% endfor %}
                ];

                var {{ major_category }}_chart_options = {
                    axisLabels: {
                        show: true
                    },
                    xaxis: {
                        axisLabel: '',
                        ticks: {{ major_category }}_ticks,
                        min: -0.7,
                        tickLength: 0
                    },
                    yaxis: {
                        position: 'left',
                        axisLabel: 'Percentile',
                        min: 0,
                        max: 100,
                        tickSize: 10
                    },
                    series: {
                        bars: {
                            show: true
                        }
                    },
                    bars: {
                        align: "center",
                        barWidth: 0.6
                    }
                 };

                var {{ major_category }}_dataset = [
                    {% for category, category_text, tests in categories %}
                        { label: "{{ category_text }}", data: {{ major_category }}_{{ category }}_data },
                    {% endfor %}
                ];

                $.plot("#{{ major_category }}_chart",
                        {{ major_category }}_dataset,
                        {{ major_category }}_chart_options);

            {% endfor %}

        });
    </script>

{% endblock %}
